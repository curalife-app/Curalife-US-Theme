{% capture CFH %}{{ content_for_header }}{% endcapture %}{{CFH}}

{% if CFH contains 'adminBarInjector' %}
  {% assign admin = true %}
  <script>console.log("Redirect Disabled Cause User Is Admin.")</script>
{% elsif CFH contains 'admin-bar-iframe' %}
  {% assign admin = true %}
  <script>console.log("Redirect Disabled Cause User Is Admin.")</script>
{% elsif CFH contains 'preview_bar_injector-' %}
  {% assign admin = true %}
  <script>console.log("Redirect Disabled Cause User Is Admin.")</script>
{% elsif CFH contains "redirect=false" %}
  {% assign admin = true %}
  <script>console.log("Redirect Disabled Through URL Parameter.")</script>
{% elsif customer.email == "yotam@curalife.com" %}
  {% assign admin = true %}
  <script>console.log("Redirect Cause User Is Yotam")</script>
{% endif %}

{%- comment -%} Temp: remove redirect for curaeats product page {%- endcomment -%}
{% if request.path contains 'products/curaeats' %}
  {% assign admin = true %}
  <script>console.log("Redirect Disabled For CuraEats")</script>
{% endif %}

{% unless admin %}
  <script>
    const redirectTo = url => console.log(url);

    const isRobot = /bot|spider|crawl|APIs-Google|AdsBot|Googlebot|mediapartners|Google Favicon|FeedFetcher|Google-Read-Aloud|DuplexWeb-Google|googleweblight|bing|yandex|baidu|duckduck|yahoo|ecosia|ia_archiver|facebook|instagram|pinterest|reddit|slack|twitter|whatsapp|youtube|semrush/i.test(navigator.userAgent);

    if (!isRobot) {
      fetch('https://geo.curalife.com/')
        .then(response => response.json())
        .then(({ country }) => {
          sessionStorage.setItem('country', country);
          console.log('Country:', country);
          const host = location.hostname === 'global.curalife.com' ? 'Global' : 'US';
          const countriesUs = ['US', 'PR', 'CA', 'AU'];
          const urls = {
            LT: 'https://curalife.lv',
            LV: 'https://curalife.lv',
            AT: 'https://curalife.at',
            KW: 'https://trycuralife.com',
            US: 'curalife.com',
            Global: 'global.curalife.com'
          };
          redirectTo(urls[country] || urls[host]);
        });
    }
  </script>
{% endunless %}