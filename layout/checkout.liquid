<!DOCTYPE html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
          <!-- Global site tag (gtag.js) - Google Analytics 4 YOTAM-->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F0MV256GM0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-F0MV256GM0');
</script>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0">
    <meta name="referrer" content="origin">
     {%- if settings.favicon != blank -%}
    <link rel="shortcut icon" href="{{ settings.favicon | img_url: '32x32' }}" type="image/png">
    {%- endif -%}
    <title>{{ page_title }}</title>

    
    
    {{ content_for_header }}

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}
  
  {% render 'shogun-head' %} 
    <!-- Curalife Shopify Only Google Tag Manager -->  
  {% include 'google-tag-manager'%}
{% include 'google-tag-manager-noscript'%}
{% include 'hot-jar'%}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- Yotpo Modules Script -->
    <script src="https://cdn-widgetsrepository.yotpo.com/v1/loader/5AyB8SFKOjnnor-g4qIeMg" async></script>
  
</head>
<body>
    {% for line_item in checkout.line_items %}
    {%- assign comma_list_append = ',' -%}
    {%- if forloop.last -%}
    {%- assign comma_list_append = '' -%}
    {%- endif -%}
    {%- assign productIds = productIds | append: line_item.product.id | append: comma_list_append -%}
    {% endfor %}
    
    {% assign product_ids = productIds | split: "," %}

    <script>
      
      const queryString = window.location.search;
      
      const urlParams = new URLSearchParams(queryString);
      const step = urlParams.get('step');
      if(!window.location.href.includes('thank_you') && step == null){
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
              'event': 'CheckoutStarted',
              'step': '1',
              'content_type': 'product_group',    
              'content_ids': '[{{ productIds }}]',    //if multiple contents are in the cart on the checkout add an array of all products IDs
              'value': '{{ checkout.total_price | money_without_currency }}',
              'currency': 'USD',
              'userId': '{{ checkout.customer.id }}',
              'email': '{{ checkout.email }}',
              'city': '{{checkout.shipping_address.city }}',
              'country': '{{checkout.shipping_address.country_code }}',
              'name': '{{ checkout.shipping_address.first_name }}',
              'surname': '{{ checkout.shipping_address.last_name }}',
              'phone_number': '{{checkout.shipping_address.phone }}',
              'state': '{{checkout.shipping_address.province }}',       //state or province
              'zip': '{{checkout.shipping_address.zip }}',          //ZIP or Postal code
              'num_items': '{{ checkout.line_items.size }}'
             });
      };
      
    if(step=='payment_method')
        {
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({
            'event': 'AddPaymentInfo',
            'step': '2',
            'content_type': 'product_group',    
            'content_ids': '[{{ productIds }}]',    //if multiple contents are in the cart on the checkout add an array of all products IDs
            'value': '{{ checkout.total_price | money_without_currency }}',
            'currency': 'USD',
            'userId': '{{ checkout.customer.id}}',
            'email': '{{ checkout.email }}',
            'city': '{{checkout.shipping_address.city }}',
            'country': '{{checkout.shipping_address.country_code}}',
            'name': '{{ checkout.shipping_address.first_name }}',
            'surname': '{{ checkout.shipping_address.last_name }}',
            'phone_number': '{{checkout.shipping_address.phone }}',
            'state': '{{checkout.shipping_address.province }}',       //state or province
            'zip': '{{checkout.shipping_address.zip }}',          //ZIP or Postal code
            'num_items': '{{ checkout.line_items.size }}'
          });
        };
      if(step=='shipping_method')
      {
        
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
          'event': 'addShippingDetail',
          'step': '1',
          'content_type': 'product_group',    
          'content_ids': '[{{ productIds }}]',    //if multiple contents are in the cart on the checkout add an array of all products IDs
          'value': '{{ checkout.total_price | money_without_currency }}',
          'currency': 'USD',
          'userId': '{{ checkout.customer.id }}',
          'email': '{{ checkout.email }}',
          'city': '{{checkout.shipping_address.city }}',
          'country': '{{checkout.shipping_address.country_code }}',
          'name': '{{ checkout.shipping_address.first_name }}',
          'surname': '{{ checkout.shipping_address.last_name }}',
          'phone_number': '{{checkout.shipping_address.phone }}',
          'state': '{{checkout.shipping_address.province }}',       //state or province
          'zip': '{{checkout.shipping_address.zip }}',          //ZIP or Postal code
          'num_items': '{{ checkout.line_items.size }}'
     });
      
      };
      if(window.location.href.includes('thank_you'))
      {
        if({{checkout.discounts_amount | money_without_currency}} > 0)
        {
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push(
            {
            'event': 'Purchase',
            'transectionID': '{{checkout.transactions.first.id}}',      //order ID
            'content_type': 'product_group',
            'content_ids': '[{{ productIds }}]',      //if multiple conttent are purchased add array of all products IDs
            'value': '{{ checkout.total_price | money_without_currency }}',
            'currency': 'USD',
            'userId': '{{ checkout.customer.id }}',
            'email': '{{ checkout.email }}',
            'city': '{{checkout.shipping_address.city }}',
            'country': '{{checkout.shipping_address.country_code }}',
            'name': '{{ checkout.shipping_address.first_name }}',
            'surname': '{{ checkout.shipping_address.last_name }}',
            'phone_number': '{{checkout.shipping_address.phone }}',
            'state': '{{checkout.shipping_address.province }}',       //state or province
            'zip': '{{checkout.shipping_address.zip }}',          //ZIP or Postal code
            'num_items': '{{ checkout.line_items.size }}'
            });
          } else if({{ checkout.total_price | money_without_currency }} > 0)
        {
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({
            'event': 'Purchase',
            'transectionID': '{{checkout.transactions.first.id}}',      //order ID
            'content_type': 'product_group',
            'content_ids': '[{{ productIds }}]',      //if multiple conttent are purchased add array of all products IDs
            'value': '{{ checkout.total_price | money_without_currency }}',
            'currency': 'USD',
            'userId': '{{ checkout.customer.id }}',
            'email': '{{ checkout.email }}',
            'city': '{{checkout.shipping_address.city }}',
            'country': '{{checkout.shipping_address.country_code }}',
            'name': '{{ checkout.shipping_address.first_name }}',
            'surname': '{{ checkout.shipping_address.last_name }}',
            'phone_number': '{{checkout.shipping_address.phone }}',
            'state': '{{checkout.shipping_address.province }}',       //state or province
            'zip': '{{checkout.shipping_address.zip }}',          //ZIP or Postal code
            'num_items': '{{ checkout.line_items.size }}'
          });
        }
     }
    </script>

  
    
      <!-- Curalife Shopify Only Google Tag Manager (noscript) -->
    {% include 'google-tag-manager-noscript.liquid' %}
    
    {{ skip_to_content_link }}

    <header class="banner" data-header role="banner">
      <div class="wrap">
        {{ content_for_logo }}
      </div>
    </header>

    {{ order_summary_toggle }}
    {% if order.created_at %}
    <div class="yotpo-widget-instance" data-yotpo-instance-id="18049"></div>
    {% endif %}
    <div class="yotpo-widget-instance" data-yotpo-instance-id="18962"></div>
    <div class="content" data-content>
      <div class="wrap">
       
        <div class="main">
          <header class="main__header" role="banner">
            {{ content_for_logo }}
            {{ breadcrumb }}
            {{ alternative_payment_methods }}
          </header>
          <main class="main__content" role="main">
            {{ content_for_layout }}
            <div style="display:flex;justify-content:flex-end;"><p style="margin-top:10px;">By clicking the continue button I Agree to CuraLife's <a href="https://curalife.com/policies/terms-of-service">Terms & Conditions</a>.</p></div>
          </main>
          <footer class="main__footer" role="contentinfo">
            {{ content_for_footer }}
          </footer>
        </div>
        <aside class="sidebar" role="complementary">
          <div class="sidebar__header">
            {{ content_for_logo }}
          </div>
          <div class="sidebar__content">
            {{ content_for_order_summary }}      
          </div>
          <div class="yotpo-widget-instance" data-yotpo-instance-id="35419"></div>
        </aside>
      </div>
    </div>

    {{ tracking_code }}
   
   	<script async type="text/javascript" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=XWfxAu&module=CONSENT_AT_CHECKOUT"></script>
  	{% include 'smsbump_checkout_marketing_subscription' %}
  </body>
</html>
